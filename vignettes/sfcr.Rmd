---
title: "sfcr"
output: rmarkdown::html_vignette
references:
- id: godley2007monetary
  title: >
       Monetary Economics: An Integrated Approach To Credit, Money, Income, Production and Wealth
  author:
  - family: Godley
    given: Wynne
  - family: Lavoie
    given: Marc
  publisher: Palgrave Macmillan
  type: book
  issued:
    year: 2007
vignette: >
  %\VignetteIndexEntry{sfcr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The `sfcr` package is structured around two functions: `sfcr_sim()` and `sfcr_scenario()`.

## `sfcr_sim()`

The `sfcr_sim()` takes a list of equations defining a set of endogenous variables and lists of exogenous variables' values and parameters to find the steady state of the model. It can take up to eight arguments:

1. `equations`:
  A list containing all the equations that define the endogenous variables in the model to be simulated. The equations must be written with standard R formula syntax where the left-hand side is separated from the right-hand side by a "~". Naming the items in the `equations` list is optional, but come in handy with bigger models.

2. `exogenous`:
  A list containing the exogenous variables' and their values. Must be written using the R formula syntax.
  
  e.g.:
  ```
  exogenous = list(
  G_d ~ 20
  )
  ```
  
3. `parameters`:
  A list containing the exogenous variables' and their values. Must be written using the R formula syntax.
  
4. `periods`:
  An integer to define the total number of periods in the simulation.
  
5. `initial`:
  Defaults to `NULL`. If specified, must be a list containing the names and the initial values of selected endogenous variables. It myst be written using the R syntax.
  
6. `hidden`:
  Defaults to `NULL`. If specified, must be a named vector that defines the hidden (or left-out) equation of the model.
  
  e.g.:
  ```
  hidden = c("H_h" = "H_s")
  ```

7. `max_iter`:
  An integer defining the maximum number of iterations allowed per period.
  
8. `.hidden_tol`:
  A double indicating the tolerance accepted for testing the equality of the hidden variable.
  

Below is the code used to simulate the SIM model from @godley2007monetary [ch. 3]:

```{r setup}
library(sfcr)

eqs <- list(
  TX_s ~ TX_d,
  YD ~ W * N_s - TX_s,
  C_d ~ alpha1 * YD + alpha2 * H_h[-1],
  H_h ~ YD - C_d + H_h[-1],
  N_s ~ N_d,
  N_d ~ Y / W,
  C_s ~ C_d,
  G_s ~ G_d,
  Y ~ C_s + G_s,
  TX_d ~ theta * W * N_s,
  H_s ~ G_d - TX_d + H_s[-1]
)

exg <- list(
  G_d ~ 20,
  W ~ 1
  )

params <- list(
  alpha1 ~ 0.6, 
  alpha2 ~ 0.4,
  theta ~ 0.2
  )

hidden <- c("H_s" = "H_h")

sim_model <- sfcr_sim(
  equations = eqs,
  exogenous = exg,
  parameters = params,
  periods = 30,
  initial = NULL,
  hidden = hidden,
  .hidden_tol = 1
)

```

## `sfcr_scenario()`

The `sfc_scenario()` function takes a simulated model calculated with `sfcr_sim()` and simulate what happens when we change the values of one or more exogenous variables or parameters.

It accepts four arguments:

sfcr_sim, scenario, periods, max_iter = 350

1. `sfcr_sim`:
  The model simulated with `sfcr_sim()` (a `sfcr_tbl` object)
  
2. `scenario`:
  One or more `sfcr_shock`s, enveloped in list, containing the variables that are going to be shocked, the period when the shock will start, end the period when the shocks ends. See `help(sfcr_shock)` for more details on how to create a shock.
  
  
The other two arguments (`periods` and `max_iter`) have the same meaning as in the `sfcr_sim()` function.

## Example:

A single shock on government expenditure, increasing from 20 to 30 from period 5 to period 30:

```{r}
shock1 <- sfcr_shock(
  variables = list(G_d ~ 30),
  start = 5,
  end = 30
  )

sfcr_scenario(
  sfcr_sim = sim_model,
  scenario = list(shock1),
  periods = 30
  )
```

Two shocks on the same model:

```{r}
shock2 <- sfcr_shock(
  variables = list(W ~ 1.5),
  start = 2,
  end = 15
)

sfcr_scenario(
  sfcr_sim = sim_model,
  scenario = list(shock1, shock2),
  periods = 30
  ) %>%
  # Extra line of code to place `G_d` and `W` on the second and third column
  dplyr::select(period, G_d, W, tidyselect::everything())
```


## References
